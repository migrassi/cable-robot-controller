<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cable Robot Controller</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>Cable Robot Controller</h1>
            <div class="status-bar">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot simulation"></span>
                    <span>SIMULATION MODE</span>
                </div>
                <div class="safety-controls">
                    <button id="systemActivate" class="safety-btn activate">ACTIVATE SYSTEM</button>
                    <button id="emergencyStop" class="emergency-btn">EMERGENCY STOP</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel: 3D Viewport -->
            <div class="left-panel">
                <!-- 3D Viewport -->
                <section class="viewport-section">
                    <div class="panel-header">
                        <h2>3D Workspace</h2>
                        <div class="view-controls">
                            <button id="resetView" class="view-btn">Reset View</button>
                            <button id="topView" class="view-btn">Top View</button>
                            <button id="sideView" class="view-btn">Side View</button>
                            <button id="frontView" class="view-btn">Front View</button>
                        </div>
                    </div>
                    <div id="viewport" class="viewport"></div>
                    <div class="position-display">
                        <div class="coord">X: <span id="posX">0.00</span> m</div>
                        <div class="coord">Y: <span id="posY">0.00</span> m</div>
                        <div class="coord">Z: <span id="posZ">2.50</span> m (Height)</div>
                    </div>
                </section>
            </div>

            <!-- Center Panel: Movement Controls -->
            <div class="center-panel">
                <!-- Movement Controls -->
                <section class="controls-section-vertical">
                    <div class="panel-header">
                        <h2>Movement Controls</h2>
                        <div class="control-status">
                            <span id="systemStatus" class="status-inactive">SYSTEM INACTIVE</span>
                        </div>
                    </div>
                    <div class="controls-vertical">
                        <div class="control-group-vertical">
                            <h3>X Axis</h3>
                            <div class="button-row">
                                <button class="move-btn" data-axis="x" data-direction="-1" disabled>‚Üê LEFT</button>
                                <button class="move-btn" data-axis="x" data-direction="1" disabled>RIGHT ‚Üí</button>
                            </div>
                            <input type="range" id="xSlider" min="-2.5" max="2.5" value="0" step="0.1" disabled>
                        </div>
                        
                        <div class="control-group-vertical">
                            <h3>Y Axis</h3>
                            <div class="button-row">
                                <button class="move-btn" data-axis="y" data-direction="1" disabled>‚Üë FRONT</button>
                                <button class="move-btn" data-axis="y" data-direction="-1" disabled>‚Üì BACK</button>
                            </div>
                            <input type="range" id="ySlider" min="-2.5" max="2.5" value="0" step="0.1" disabled>
                        </div>
                        
                        <div class="control-group-vertical">
                            <h3>Z Axis (Height)</h3>
                            <div class="button-row">
                                <button class="move-btn" data-axis="z" data-direction="1" disabled>‚Üë UP</button>
                                <button class="move-btn" data-axis="z" data-direction="-1" disabled>‚Üì DOWN</button>
                            </div>
                            <input type="range" id="zSlider" min="0.5" max="4.5" value="2.5" step="0.1" disabled>
                        </div>
                        
                        <div class="control-group-vertical">
                            <h3>Quick Positions</h3>
                            <div class="button-row">
                                <button class="quick-btn" onclick="goToPosition(0, 0, 2.5)" disabled>Center</button>
                                <button class="quick-btn" onclick="goToPosition(1, 1, 3)" disabled>High</button>
                            </div>
                            <div class="button-row">
                                <button class="quick-btn" onclick="goToPosition(-1, -1, 1)" disabled>Low</button>
                                <button class="quick-btn" onclick="goToPosition(0, 0, 4)" disabled>Top</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel: Camera and Status -->
            <div class="right-panel">
                <!-- Camera Monitor -->
                <section class="camera-section">
                    <div class="panel-header">
                        <h2>Camera Monitor</h2>
                        <div class="camera-controls">
                            <button id="fullscreenCamera" disabled>‚õ∂</button>
                            <button id="snapshot" disabled>üì∑</button>
                            <button id="recordToggle" disabled>‚è∫Ô∏è</button>
                        </div>
                    </div>
                    <div class="camera-container">
                        <div class="camera-placeholder">
                            <div class="no-signal">
                                <span>üìπ</span>
                                <p>Camera Simulation</p>
                                <small>Activate system to enable camera</small>
                            </div>
                        </div>
                        <div class="camera-overlay">
                            <div class="crosshair"></div>
                            <div class="camera-info">
                                <span id="cameraResolution">1920x1080</span>
                                <span id="cameraFPS">30 FPS</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- System Status -->
                <section class="status-section">
                    <div class="panel-header">
                        <h2>System Status</h2>
                    </div>
                    <div class="status-items">
                        <div class="status-item">
                            <span class="label">Robot Status:</span>
                            <span class="value" id="robotStatus">Inactive</span>
                        </div>
                        <div class="status-item">
                            <span class="label">System Power:</span>
                            <span class="value" id="systemPower">OFF</span>
                        </div>
                        <div class="status-item">
                            <span class="label">Safety Status:</span>
                            <span class="value" id="safetyStatus">SAFE</span>
                        </div>
                        <div class="status-item">
                            <span class="label">Cable Tension:</span>
                            <span class="value" id="cableTension">-</span>
                        </div>
                        <div class="status-item">
                            <span class="label">Position:</span>
                            <span class="value" id="positionStatus">Center</span>
                        </div>
                        <div class="status-item">
                            <span class="label">Last Command:</span>
                            <span class="value" id="lastCommand">System Standby</span>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Fullscreen Camera Modal -->
        <div id="fullscreenModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <div class="fullscreen-camera-placeholder">
                    <span>üìπ</span>
                    <p>Camera Simulation</p>
                </div>
            </div>
        </div>

    <script src="js/three-setup.js"></script>
    <script>
        // Cable Robot Controller - Simulation Mode
        let robotVisualization;
        let systemActive = false;
        let emergencyStop = false;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Cable Robot Controller (Simulation Mode)...');
            
            // Initialize 3D visualization
            robotVisualization = new RobotVisualization('viewport');
            
            // Setup controls and safety systems
            setupSafetyControls();
            setupMovementControls();
            setupViewControls();
            setupCameraSimulation();
            
            // Start status updates
            updateSystemStatus();
            setInterval(updateSystemStatus, 1000);
            
            console.log('Controller initialized successfully');
        });

        function setupSafetyControls() {
            // System Activation
            document.getElementById('systemActivate').addEventListener('click', () => {
                if (emergencyStop) {
                    showNotification('Clear emergency stop first!', 'warning');
                    return;
                }
                
                systemActive = !systemActive;
                const btn = document.getElementById('systemActivate');
                
                if (systemActive) {
                    btn.textContent = 'DEACTIVATE SYSTEM';
                    btn.className = 'safety-btn deactivate';
                    enableControls();
                    showNotification('System Activated', 'success');
                    updateLastCommand('System Activated');
                } else {
                    btn.textContent = 'ACTIVATE SYSTEM';
                    btn.className = 'safety-btn activate';
                    disableControls();
                    showNotification('System Deactivated', 'info');
                    updateLastCommand('System Deactivated');
                }
            });

            // Emergency Stop
            document.getElementById('emergencyStop').addEventListener('click', () => {
                emergencyStop = true;
                systemActive = false;
                
                // Reset activation button
                const activateBtn = document.getElementById('systemActivate');
                activateBtn.textContent = 'ACTIVATE SYSTEM';
                activateBtn.className = 'safety-btn activate';
                
                disableControls();
                showNotification('EMERGENCY STOP ACTIVATED!', 'error');
                updateLastCommand('EMERGENCY STOP');
                
                // Auto-clear after 5 seconds in simulation
                setTimeout(() => {
                    emergencyStop = false;
                    showNotification('Emergency stop cleared (simulation)', 'info');
                }, 5000);
            });
        }

        function setupMovementControls() {
            // Movement buttons
            document.querySelectorAll('.move-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (!systemActive || emergencyStop) return;
                    
                    const axis = e.target.dataset.axis;
                    const direction = parseFloat(e.target.dataset.direction);
                    const step = 0.3;
                    
                    if (robotVisualization) {
                        const currentPos = robotVisualization.getRobotPosition();
                        let newX = currentPos.x;
                        let newY = currentPos.y; 
                        let newZ = currentPos.z;
                        
                        if (axis === 'x') newX += direction * step;
                        if (axis === 'y') newY += direction * step;
                        if (axis === 'z') newZ += direction * step;
                        
                        // Apply workspace limits
                        newX = Math.max(-2.5, Math.min(2.5, newX));
                        newY = Math.max(-2.5, Math.min(2.5, newY));
                        newZ = Math.max(0.5, Math.min(4.5, newZ));
                        
                        robotVisualization.setRobotPosition(newX, newY, newZ);
                        updatePositionDisplay(newX, newY, newZ);
                        updateSliders(newX, newY, newZ);
                        updateLastCommand(`Move ${axis.toUpperCase()}: ${direction > 0 ? '+' : ''}${(direction * step).toFixed(1)}m`);
                    }
                });
            });

            // Sliders
            ['x', 'y', 'z'].forEach(axis => {
                const slider = document.getElementById(axis + 'Slider');
                if (slider) {
                    slider.addEventListener('input', (e) => {
                        if (!systemActive || emergencyStop) return;
                        
                        if (robotVisualization) {
                            const currentPos = robotVisualization.getRobotPosition();
                            const newValue = parseFloat(e.target.value);
                            
                            let newX = currentPos.x;
                            let newY = currentPos.y;
                            let newZ = currentPos.z;
                            
                            if (axis === 'x') newX = newValue;
                            if (axis === 'y') newY = newValue;
                            if (axis === 'z') newZ = newValue;
                            
                            robotVisualization.setRobotPosition(newX, newY, newZ);
                            updatePositionDisplay(newX, newY, newZ);
                            updateLastCommand(`Set ${axis.toUpperCase()}: ${newValue.toFixed(2)}m`);
                        }
                    });
                }
            });
        }

        function setupViewControls() {
            // View control buttons
            document.getElementById('resetView')?.addEventListener('click', () => {
                if (robotVisualization) {
                    robotVisualization.resetCameraView();
                    showNotification('Camera view reset', 'info');
                }
            });
            
            document.getElementById('topView')?.addEventListener('click', () => {
                if (robotVisualization) {
                    robotVisualization.setTopView();
                    showNotification('Top view activated', 'info');
                }
            });
            
            document.getElementById('sideView')?.addEventListener('click', () => {
                if (robotVisualization) {
                    robotVisualization.setSideView();
                    showNotification('Side view activated', 'info');
                }
            });
            
            document.getElementById('frontView')?.addEventListener('click', () => {
                if (robotVisualization) {
                    robotVisualization.setFrontView();
                    showNotification('Front view activated', 'info');
                }
            });
        }

        function setupCameraSimulation() {
            // Camera controls - all simulated
            document.getElementById('fullscreenCamera')?.addEventListener('click', () => {
                if (systemActive) {
                    document.getElementById('fullscreenModal').style.display = 'block';
                } else {
                    showNotification('Activate system first', 'warning');
                }
            });
            
            document.getElementById('snapshot')?.addEventListener('click', () => {
                if (systemActive) {
                    showNotification('Snapshot saved (simulated)', 'success');
                } else {
                    showNotification('Activate system first', 'warning');
                }
            });
            
            document.getElementById('recordToggle')?.addEventListener('click', () => {
                if (systemActive) {
                    showNotification('Recording toggled (simulated)', 'info');
                } else {
                    showNotification('Activate system first', 'warning');
                }
            });

            // Close modal
            document.querySelector('.close')?.addEventListener('click', () => {
                document.getElementById('fullscreenModal').style.display = 'none';
            });
        }

        function goToPosition(x, y, z) {
            if (!systemActive || emergencyStop) {
                showNotification('System not active', 'warning');
                return;
            }
            
            if (robotVisualization) {
                robotVisualization.setRobotPosition(x, y, z);
                updatePositionDisplay(x, y, z);
                updateSliders(x, y, z);
                updateLastCommand(`Go to position: (${x}, ${y}, ${z})`);
                showNotification(`Moving to position (${x}, ${y}, ${z})`, 'info');
            }
        }

        function enableControls() {
            document.querySelectorAll('.move-btn, .quick-btn, input[type="range"]').forEach(el => {
                el.disabled = false;
            });
            document.querySelectorAll('#fullscreenCamera, #snapshot, #recordToggle').forEach(el => {
                el.disabled = false;
            });
        }

        function disableControls() {
            document.querySelectorAll('.move-btn, .quick-btn, input[type="range"]').forEach(el => {
                el.disabled = true;
            });
            document.querySelectorAll('#fullscreenCamera, #snapshot, #recordToggle').forEach(el => {
                el.disabled = true;
            });
        }

        function updatePositionDisplay(x, y, z) {
            document.getElementById('posX').textContent = x.toFixed(2);
            document.getElementById('posY').textContent = y.toFixed(2);
            document.getElementById('posZ').textContent = z.toFixed(2);
        }

        function updateSliders(x, y, z) {
            document.getElementById('xSlider').value = x;
            document.getElementById('ySlider').value = y;
            document.getElementById('zSlider').value = z;
        }

        function updateSystemStatus() {
            // Update status indicators
            document.getElementById('systemStatus').textContent = systemActive ? 'SYSTEM ACTIVE' : 'SYSTEM INACTIVE';
            document.getElementById('systemStatus').className = systemActive ? 'status-active' : 'status-inactive';
            
            document.getElementById('robotStatus').textContent = emergencyStop ? 'EMERGENCY STOP' : (systemActive ? 'Ready' : 'Inactive');
            document.getElementById('systemPower').textContent = systemActive ? 'ON' : 'OFF';
            document.getElementById('safetyStatus').textContent = emergencyStop ? 'EMERGENCY' : 'SAFE';
            document.getElementById('cableTension').textContent = systemActive ? 'Normal' : '-';
            
            // Update position status
            if (robotVisualization) {
                const pos = robotVisualization.getRobotPosition();
                const isCenter = Math.abs(pos.x) < 0.1 && Math.abs(pos.y) < 0.1;
                document.getElementById('positionStatus').textContent = isCenter ? 'Center' : `(${pos.x.toFixed(1)}, ${pos.y.toFixed(1)}, ${pos.z.toFixed(1)})`;
            }
        }

        function updateLastCommand(command) {
            document.getElementById('lastCommand').textContent = command;
        }

        function showNotification(message, type = 'info') {
            // Simple notification system
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>